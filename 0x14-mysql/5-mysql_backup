#!/usr/bin/env bash
# Dumps and archives all MySQL databases

if [ $# -ne 1 ]; then
    echo "Usage: $0 <MySQL root password>"
    exit 1
fi

# Timestamp for the archive name
timestamp=$(date +%d-%m-%Y)

# MySQL root password provided as an argument
password="$1"

# Output file name for the dump
output_file="backup.sql"

# Dump all MySQL databases to backup.sql using mysqldump
mysqldump -u root -p"$password" --all-databases > "$output_file"

# Create a compressed tar.gz archive
archive_name="$timestamp.tar.gz"
tar -czvf "$archive_name" "$output_file"

# Remove the dump file after creating the archive
rm "$output_file"

echo "MySQL backup created and compressed as $archive_name"

